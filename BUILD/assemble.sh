#!/bin/bash
HEADER="# THIS FILE IS GENERATED BY BUILD/assemble.sh
# DO NOT EDIT THIS FILE DIRECTLY. EDIT THE .DAT FILES IN THE /BUILD/ FOLDER THEN RUN assemble.sh
"

for DIR in ./*/; do
	DIR_STRIP_LEAD=${DIR#*/}
	DIR_CLEAN=${DIR_STRIP_LEAD%/}
	OUT="../RELEASE/data/tt_${DIR_CLEAN}.txt"
	echo "$HEADER" > $OUT
	cat $DIR/header.txt >> $OUT
	for FILENAME in ${DIR}*.dat; do
		SLOT=${FILENAME::-4}
		SLOT=${SLOT##*/}
		NUM=0
		cat $FILENAME | while read LINE; do
			if [[ $LINE == \#* ]]; then
				echo "$LINE" >> $OUT
			else
				echo "$SLOT	$NUM	$LINE" >> $OUT
				let "NUM += 1"
			fi
		done
		echo "" >> $OUT
	done
done
